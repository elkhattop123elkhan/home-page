<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ | Pro-Task</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body {
            background-color: #e9ecef;
        }
        .main-container {
            max-width: 960px;
            margin: 40px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 0;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞ */
        #login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 500px;
            padding: 20px;
        }
        #login-card {
            width: 100%;
            max-width: 400px;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å–∫—Ä—ã—Ç –¥–æ –≤—Ö–æ–¥–∞) */
        #app-container {
            display: none; 
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∫–æ–ª–µ—Å–∞ (CSS –∞–Ω–∏–º–∞—Ü–∏—è) */
        .wheel-container {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }
        #fortuneWheel {
            width: 250px;
            height: 250px;
            background: conic-gradient(
                #ffc107 0% 20%, 
                #dc3545 20% 40%, 
                #28a745 40% 60%, 
                #007bff 60% 80%, 
                #6f42c1 80% 100%
            );
            border-radius: 50%;
            margin: 20px auto;
            border: 10px solid #adb5bd;
            transition: transform 3s ease-out; 
            position: relative;
        }
        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: #f8f9fa;
            border-radius: 50%;
            border: 5px solid #343a40;
            z-index: 10;
        }
        .wheel-indicator {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 20px solid #343a40;
            z-index: 10;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è QR-–∫–æ–¥–∞ */
        #qrcode-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
    </style>
</head>
<body>

<div class="main-container">
    
    <div class="p-3 bg-primary text-white text-center rounded-top-2">
        <h2>üõ†Ô∏è –ü–∞–Ω–µ–ª—å –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
    </div>

    <div id="login-screen">
        <div class="card" id="login-card">
            <h4 class="card-title text-center mb-4">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h4>
            <div class="mb-3">
                <label for="loginInput" class="form-label">–õ–æ–≥–∏–Ω (–ò–∑ –¢–∞–±–ª–∏—Ü—ã)</label>
                <input type="text" class="form-control" id="loginInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
            </div>
            <div class="mb-3">
                <label for="passwordInput" class="form-label">–ü–∞—Ä–æ–ª—å (–ò–∑ –¢–∞–±–ª–∏—Ü—ã)</label>
                <input type="password" class="form-control" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <button class="btn btn-primary w-100" onclick="handleLogin()">–í–æ–π—Ç–∏</button>
            <div id="login-message" class="alert d-none mt-3"></div>
            <p class="mt-3 text-center text-muted small">
                –¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã (–µ—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¢–∞–±–ª–∏—Ü—É):<br>
                user1/pass1, user2/pass2
            </p>
        </div>
    </div>
    
    <div id="app-container">

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#home" type="button">–ì–ª–∞–≤–Ω–∞—è</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#wheel" type="button">–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tasks" type="button">–ó–∞–¥–∞–Ω–∏—è</button>
            </li>
            <li class="nav-item ms-auto">
                <button class="btn btn-danger m-2" data-bs-toggle="tab" data-bs-target="#finish" type="button">–ó–∞–∫–æ–Ω—á–∏—Ç—å –°–º–µ–Ω—É</button>
            </li>
        </ul>

        <div class="tab-content p-4">
            
            <div class="tab-pane fade show active" id="home" role="tabpanel">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card text-white bg-success">
                            <div class="card-body">
                                <h5 class="card-title">üíµ –ë–∞–ª–∞–Ω—Å (SUM)</h5>
                                <p class="card-text fs-2" id="currentBalance">0.00</p>
                                <p class="card-text small">–ê–∫–∫–∞—É–Ω—Ç: <strong id="currentLogin"></strong></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card text-white bg-info">
                            <div class="card-body">
                                <h5 class="card-title">üçÄ –í—Ä–∞—â–µ–Ω–∏–π –ö–æ–ª–µ—Å–∞</h5>
                                <p class="card-text fs-2" id="spinsCount">0</p>
                                <p class="card-text small">–î–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ä–∞—â–µ–Ω–∏–π.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h4 class="mt-4">üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ ID –ß–µ–∫–∞</h4>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="checkIdInput" placeholder="–í–≤–µ–¥–∏—Ç–µ ID —á–µ–∫–∞ (16 —Ü–∏—Ñ—Ä)" maxlength="16">
                    <button class="btn btn-primary" type="button" onclick="simulateDeposit()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                </div>
                <div id="message" class="alert d-none"></div>
            </div>

            <div class="tab-pane fade" id="wheel" role="tabpanel">
                <h3 class="mb-3">–ö–æ–ª–µ—Å–æ –£–¥–∞—á–∏!</h3>
                <p>–í–∞—à–∏ —à–∞–Ω—Å—ã: <strong><span id="spinsCountWheel">0</span></strong> –≤—Ä–∞—â–µ–Ω–∏–π –æ—Å—Ç–∞–ª–æ—Å—å.</p>
                
                <div class="wheel-container">
                    <div id="fortuneWheel">
                        <div class="wheel-center"></div>
                    </div>
                    <div class="wheel-indicator"></div>

                    <button class="btn btn-danger btn-lg mt-4" id="spinButton" onclick="spinWheel()" disabled>–ö—Ä—É—Ç–∏—Ç—å –ö–æ–ª–µ—Å–æ!</button>
                    <p class="mt-3 fs-5" id="wheelResultDisplay"></p>
                    <p class="text-muted small">–ë–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É.</p>
                </div>
            </div>

            <div class="tab-pane fade" id="tasks" role="tabpanel">
                <h3 class="mb-3">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è</h3>
                <p>–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ—Ö–æ–¥ –∏ –ø–æ–ª—É—á–∏—Ç—å –≤—Ä–∞—â–µ–Ω–∏—è –¥–ª—è –ö–æ–ª–µ—Å–∞!</p>
                
                <ul class="list-group" id="tasksList">
                    <li class="list-group-item">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π...</li>
                </ul>
            </div>
            
            <div class="tab-pane fade" id="finish" role="tabpanel">
                <h3 class="mb-4">–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –°–º–µ–Ω—ã –∏ –û—Ç—á–µ—Ç</h3>
                
                <div id="qrcode-container" class="mb-4">
                    <p>–ù–∞–∂–º–∏—Ç–µ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –û—Ç—á–µ—Ç", —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å QR-–∫–æ–¥ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∞–∫–∫–∞—É–Ω—Ç–∞:</p>
                    <button class="btn btn-primary mb-3" onclick="generateReport()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –û—Ç—á–µ—Ç</button>
                    <div id="qrcode" class="border p-2"></div>
                    <p class="mt-2 text-muted small">–ë–∞–ª–∞–Ω—Å, –≤—Ä–∞—â–µ–Ω–∏—è, –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–∑–æ–≤.</p>
                </div>
                
                <button class="btn btn-success" id="downloadReportButton" onclick="downloadReport()" disabled>
                    üíæ –°–∫–∞—á–∞—Ç—å –ß–µ–∫-—Ñ–∞–π–ª (.txt)
                </button>
                
                <div class="alert alert-warning mt-3">
                    –ü–æ—Å–ª–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞, **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä—É –≤ Telegram: <a href="https://t.me/elkhattop123" target="_blank">@elkhattop123</a>
                </div>

                <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" value="" id="confirmSend" disabled>
                    <label class="form-check-label" for="confirmSend">
                        –Ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é, —á—Ç–æ —Å–∫–∞—á–∞–ª —Ñ–∞–π–ª –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä—É –≤ Telegram.
                    </label>
                </div>
                <button class="btn btn-success btn-lg mt-3" id="completeShiftButton" onclick="completeShift()" disabled>
                    ‚úÖ –í—Å–µ —Å–¥–µ–ª–∞–Ω–æ. –ó–∞–≤–µ—Ä—à–∏—Ç—å!
                </button>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // ----------------------------------------------------------------------
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 
    // ----------------------------------------------------------------------
    
    // ID –¢–í–û–ï–ô –¢–ê–ë–õ–ò–¶–´, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ —Å—Å—ã–ª–∫–∏: 1HyCtUlU5VDBSvy9grZwMca5Ld5cy3ybR-Jg7WB6sMoE
    const SHEET_ID = '1HyCtUlU5VDBSvy9grZwMca5Ld5cy3ybR-Jg7WB6sMoE';
    const GID = '0'; // ID –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Å—Ç–∞
    
    // URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –í–°–ï–• –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.
    // –≠–¢–û–¢ –ó–ê–ü–†–û–° –†–ê–ë–û–¢–ê–ï–¢ –¢–û–õ–¨–ö–û –ü–†–ò –ó–ê–ü–£–°–ö–ï –ö–û–î–ê –ù–ê –í–ï–ë-–°–ï–†–í–ï–†–ï (HTTPS://...)!
    const GOOGLE_SHEET_DATA_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`; 

    // –°–ò–ú–£–õ–Ø–¶–ò–û–ù–ù–´–ï –î–ê–ù–ù–´–ï (–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å –∏–∑-–∑–∞ CORS)
    const MOCK_ACCOUNTS_DATA = [
        { login: "user1", password: "pass1", balance: 150000.00, spins: 3, prize_history: ["–ù–∞—á–∞–ª—å–Ω—ã–π –≤–∫–ª–∞–¥: 150 000.00 SUM"] },
        { login: "user2", password: "pass2", balance: 50000.00, spins: 1, prize_history: ["–ù–∞—á–∞–ª—å–Ω—ã–π –≤–∫–ª–∞–¥: 50 000.00 SUM"] }
    ];

    const MOCK_TASKS_LIST = [
        { id: 1, name: "–ü–æ—Å—Ç–∞–≤–∏—Ç—å 5 –ª–∞–π–∫–æ–≤ –≤ Instagram", reward: 10000, type: "sum" },
        { id: 2, name: "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å 1 –¥—Ä—É–≥–∞", reward: 1, type: "spin" },
        { id: 3, name: "–û—Å—Ç–∞–≤–∏—Ç—å 3 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è", reward: 5000, type: "sum" }
    ];

    let accountData = {}; 
    
    const wheelSegments = [
        { text: "0 SUM", amount: 0, color: "#999" },
        { text: "10 000 SUM", amount: 10000, color: "#007bff" },
        { text: "25 000 SUM", amount: 25000, color: "#28a745" },
        { text: "50 000 SUM", amount: 50000, color: "#ffc107" },
        { text: "–î–∂–µ–∫–ø–æ—Ç! 100 000 SUM", amount: 100000, color: "#dc3545" }
    ];

    const spinButton = document.getElementById('spinButton');
    const wheelElement = document.getElementById('fortuneWheel');
    const wheelResultDisplay = document.getElementById('wheelResultDisplay');
    const qrcodeContainer = document.getElementById('qrcode');
    const downloadReportButton = document.getElementById('downloadReportButton');
    const confirmSendCheckbox = document.getElementById('confirmSend');
    const completeShiftButton = document.getElementById('completeShiftButton');
    const tasksListContainer = document.getElementById('tasksList'); 
    
    let isReportGenerated = false;


    // ----------------------------------------------------------------------
    // –§—É–Ω–∫—Ü–∏—è –ü–∞—Ä—Å–∏–Ω–≥–∞ –î–∞–Ω–Ω—ã—Ö –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã
    // ----------------------------------------------------------------------

    /**
     * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ GVIZ –≤ —É–¥–æ–±–Ω—ã–π –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤.
     * @param {object} data - JSON-–æ–±—ä–µ–∫—Ç, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç Google.
     * @returns {Array} –ú–∞—Å—Å–∏–≤ –∞–∫–∫–∞—É–Ω—Ç–æ–≤.
     */
    function parseSheetData(data) {
        if (!data.table || !data.table.rows) return [];

        const accounts = [];
        const rows = data.table.rows;

        // –ù–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
        // –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –ï—Å–ª–∏ –≤ –¢–∞–±–ª–∏—Ü–µ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –Ω–∞—á–Ω–∏—Ç–µ —Å 'for (let i = 1; i < rows.length; i++) {'
        for (let i = 0; i < rows.length; i++) {
            const row = rows[i].c;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤ —Å—Ç—Ä–æ–∫–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç–æ–ª–±—Ü–æ–≤ (–º–∏–Ω–∏–º—É–º 5: A, B, C, D, E)
            if (row.length < 5 || !row[1] || !row[2] || !row[3] || !row[4]) continue;

            const login = row[1] ? (row[1].v || '') : '';       // –°—Ç–æ–ª–±–µ—Ü B (–ò–Ω–¥–µ–∫—Å 1)
            const password = row[2] ? (row[2].v || '') : '';    // –°—Ç–æ–ª–±–µ—Ü C (–ò–Ω–¥–µ–∫—Å 2)
            const balance = row[3] ? (parseFloat(row[3].v) || 0) : 0; // –°—Ç–æ–ª–±–µ—Ü D (–ò–Ω–¥–µ–∫—Å 3)
            const spins = row[4] ? (parseInt(row[4].v) || 0) : 0;     // –°—Ç–æ–ª–±–µ—Ü E (–ò–Ω–¥–µ–∫—Å 4)
            
            if (login && password) {
                accounts.push({
                    login: login,
                    password: password,
                    balance: balance,
                    spins: spins,
                    prize_history: [`–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: ${balance.toLocaleString('ru-RU')} SUM`]
                });
            }
        }
        return accounts;
    }


    // ----------------------------------------------------------------------
    // –û—Å–Ω–æ–≤–Ω–∞—è –õ–æ–≥–∏–∫–∞ –í—Ö–æ–¥–∞: –ó–∞–≥—Ä—É–∑–∫–∞ + –ü—Ä–æ–≤–µ—Ä–∫–∞
    // ----------------------------------------------------------------------
    
    async function handleLogin() {
        const loginInput = document.getElementById('loginInput').value.trim();
        const passwordInput = document.getElementById('passwordInput').value.trim();
        const loginMessage = document.getElementById('login-message');
        loginMessage.classList.add('d-none');
        loginMessage.classList.remove('alert-success', 'alert-danger', 'alert-warning');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –∏–¥–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å
        loginMessage.classList.add('alert-warning');
        loginMessage.textContent = '... –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã ...';
        loginMessage.classList.remove('d-none');
        
        let allAccounts = [];

        try {
            // *** –®–ê–ì 1: –ü–û–ü–´–¢–ö–ê –ó–ê–ì–†–£–ó–ö–ò –†–ï–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–• ***
            const response = await fetch(GOOGLE_SHEET_DATA_URL);
            const text = await response.text();
            
            // –û—á–∏—Å—Ç–∫–∞ JSON –æ—Ç Google-–æ–±–æ–ª–æ—á–∫–∏ (–Ω—É–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ Google –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç, –∞ –Ω–µ —á–∏—Å—Ç—ã–π JSON)
            const jsonString = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
            const data = JSON.parse(jsonString);

            allAccounts = parseSheetData(data);
            
            console.log("‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤:", allAccounts.length);
            loginMessage.textContent = '‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑ –¢–∞–±–ª–∏—Ü—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—è—é –ª–æ–≥–∏–Ω...';
            loginMessage.classList.replace('alert-warning', 'alert-success');


        } catch (error) {
            // *** –®–ê–ì 1.1: –ï–°–õ–ò –†–ï–ê–õ–¨–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –ù–ï –£–î–ê–õ–ê–°–¨ (–°–õ–£–ß–ò–¢–°–Ø –ù–ê –õ–û–ö–ê–õ–¨–ù–û–ú –§–ê–ô–õ–ï) ***
            console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¢–∞–±–ª–∏—Ü—ã (–≤–µ—Ä–æ—è—Ç–Ω–æ, –∏–∑-–∑–∞ CORS –∏–ª–∏ –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞). –ò—Å–ø–æ–ª—å–∑—É—é —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.", error);
            allAccounts = MOCK_ACCOUNTS_DATA;
            loginMessage.textContent = '‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¢–∞–±–ª–∏—Ü—É. –ò—Å–ø–æ–ª—å–∑—É—é —Ç–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã. –°–º. –∫–æ–Ω—Å–æ–ª—å.';
            loginMessage.classList.replace('alert-warning', 'alert-danger');
        }

        // -------------------------------------------------------------------
        // –®–ê–ì 2: –ü–û–ò–°–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        // -------------------------------------------------------------------

        const user = allAccounts.find(acc => acc.login === loginInput && acc.password === passwordInput);
        
        if (user) {
            // –£–°–ü–ï–®–ù–´–ô –í–•–û–î
            accountData = {
                login: user.login,
                password: user.password,
                balance: user.balance,
                spins: user.spins,
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ç–æ—Ä–∏—é, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—É—é –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
                prizeHistory: user.prize_history, 
                transactionHistory: user.prize_history.slice() 
            };
            
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            document.getElementById('currentLogin').textContent = accountData.login; 
            
            updateTasksList(MOCK_TASKS_LIST);
            updateUI();
            
        } else {
            // –û–®–ò–ë–ö–ê –í–•–û–î–ê
            loginMessage.textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å.';
            loginMessage.classList.replace('alert-success', 'alert-danger');
        }
    }


    // ----------------------------------------------------------------------
    // –§—É–Ω–∫—Ü–∏–∏ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –õ–æ–≥–∏–∫–∏
    // ----------------------------------------------------------------------

    function updateTasksList(tasks) {
        tasksListContainer.innerHTML = ''; 
        
        tasks.forEach(task => {
            const rewardText = task.type === 'sum' 
                               ? `+${task.reward.toLocaleString('ru-RU')} SUM` 
                               : `+${task.reward} –í—Ä–∞—â–µ–Ω–∏–µ`;
            
            const listItem = document.createElement('li');
            listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
            listItem.innerHTML = `
                <span>${task.name} (${rewardText})</span>
                <button class="btn btn-warning btn-sm" onclick="completeTask(${task.id}, ${task.reward}, '${task.type}')">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
            `;
            tasksListContainer.appendChild(listItem);
        });
    }

    function completeTask(taskId, reward, type) {
        const taskName = MOCK_TASKS_LIST.find(t => t.id === taskId).name;
        
        if (type === 'sum') {
            accountData.balance += reward;
            accountData.transactionHistory.push(`–ó–∞–¥–∞–Ω–∏–µ "${taskName}" –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: +${reward.toLocaleString('ru-RU')} SUM`);
            alert(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –ù–∞—á–∏—Å–ª–µ–Ω–æ: ${reward.toLocaleString('ru-RU')} SUM`);
        } else if (type === 'spin') {
            accountData.spins += reward;
            accountData.transactionHistory.push(`–ó–∞–¥–∞–Ω–∏–µ "${taskName}" –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: +${reward} –í—Ä–∞—â–µ–Ω–∏–µ`);
            alert(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –ù–∞—á–∏—Å–ª–µ–Ω–æ: ${reward} –í—Ä–∞—â–µ–Ω–∏–µ.`);
        }
        
        updateUI();
    }


    function updateUI() {
        if (!accountData.login) return; 

        const balanceElements = document.querySelectorAll('#currentBalance');
        const spinsElements = document.querySelectorAll('#spinsCount, #spinsCountWheel');

        balanceElements.forEach(el => el.textContent = `${accountData.balance.toLocaleString('ru-RU')} SUM`);
        spinsElements.forEach(el => el.textContent = accountData.spins);
        
        spinButton.disabled = accountData.spins <= 0;
        
        if (spinButton.disabled) {
            spinButton.textContent = "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–∞—â–µ–Ω–∏–π";
        } else {
             spinButton.textContent = "–ö—Ä—É—Ç–∏—Ç—å –ö–æ–ª–µ—Å–æ!";
        }
        
        completeShiftButton.disabled = !(downloadReportButton.disabled === true && confirmSendCheckbox.checked);
    }
    
    function simulateDeposit() {
        const checkIdInput = document.getElementById('checkIdInput');
        const checkId = checkIdInput.value.trim();
        const messageDisplay = document.getElementById('message');
        messageDisplay.className = 'alert d-none'; 
        
        if (checkId.length !== 16 || !/^\d+$/.test(checkId)) {
            messageDisplay.classList.remove('d-none');
            messageDisplay.classList.add('alert-danger');
            messageDisplay.textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID —á–µ–∫–∞. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–æ–≤–Ω–æ 16 —Ü–∏—Ñ—Ä.';
            return;
        }

        const amountString = checkId.substring(4, 8);
        const depositAmount = parseInt(amountString) * 100; 

        if (depositAmount <= 0) {
             messageDisplay.classList.remove('d-none');
             messageDisplay.classList.add('alert-danger');
             messageDisplay.textContent = '‚ùå ID —á–µ–∫–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è.';
             return;
        }

        accountData.balance += depositAmount;
        accountData.transactionHistory.push(`–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ ID ${checkId}: ${depositAmount.toLocaleString('ru-RU')} SUM`);
        updateUI();

        messageDisplay.classList.remove('d-none');
        messageDisplay.classList.add('alert-success');
        messageDisplay.textContent = `‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ! –ù–∞ —Å—á–µ—Ç –∑–∞—á–∏—Å–ª–µ–Ω–æ: ${depositAmount.toLocaleString('ru-RU')} SUM`;
        checkIdInput.value = '';
    }

    function spinWheel() {
        if (accountData.spins <= 0) return;

        spinButton.disabled = true;
        wheelResultDisplay.textContent = "–ö—Ä—É—Ç–∏–º...";
        wheelResultDisplay.className = "mt-3 fs-5 text-warning";
        accountData.spins--; 

        const finalPrizeIndex = Math.floor(Math.random() * wheelSegments.length);
        const winningPrize = wheelSegments[finalPrizeIndex];
        
        const segmentAngle = 360 / wheelSegments.length; 
        const minRotation = 360 * 5; 
        const targetAngle = minRotation + (360 - (finalPrizeIndex * segmentAngle) - (segmentAngle / 2)); 

        wheelElement.style.transform = `rotate(${targetAngle}deg)`;
        
        setTimeout(() => {
            if (winningPrize.amount > 0) {
                accountData.balance += winningPrize.amount;
                accountData.prizeHistory.push(`–í—ã–∏–≥—Ä—ã—à –≤ –ö–æ–ª–µ—Å–µ –§–æ—Ä—Ç—É–Ω—ã: ${winningPrize.amount.toLocaleString('ru-RU')} SUM`);
                wheelResultDisplay.textContent = `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winningPrize.amount.toLocaleString('ru-RU')} SUM!`;
                wheelResultDisplay.className = "mt-3 fs-5 text-success";
            } else {
                wheelResultDisplay.textContent = `üòî –£–≤—ã! –í —ç—Ç–æ—Ç —Ä–∞–∑ –ø—É—Å—Ç–æ.`;
                wheelResultDisplay.className = "mt-3 fs-5 text-danger";
            }

            updateUI(); 
            spinButton.disabled = false;

        }, 3500); 
    }

    function generateReport() {
        if (!accountData.login) return; 
        
        const reportText = `
–ê–ö–ö–ê–£–ù–¢ –û–¢–ß–ï–¢
----------------------------------------
–õ–æ–≥–∏–Ω: ${accountData.login}
–ü–∞—Ä–æ–ª—å: ${accountData.password}
–¢–µ–∫—É—â–∏–π –ë–∞–ª–∞–Ω—Å (SUM): ${accountData.balance.toLocaleString('ru-RU')}
–û—Å—Ç–∞—Ç–æ–∫ –≤—Ä–∞—â–µ–Ω–∏–π: ${accountData.spins}
----------------------------------------
–ò–°–¢–û–†–ò–Ø –ü–†–ò–ó–û–í –ö–û–õ–ï–°–ê –§–û–†–¢–£–ù–´:
${accountData.prizeHistory.join('\n')}
----------------------------------------
–ò–°–¢–û–†–ò–Ø –¢–†–ê–ù–ó–ê–ö–¶–ò–ô:
${accountData.transactionHistory.join('\n')}
----------------------------------------
–î–∞—Ç–∞/–í—Ä–µ–º—è –û—Ç—á–µ—Ç–∞: ${new Date().toLocaleString('ru-RU')}
        `;
        
        const qr = qrcode(0, 'L');
        qr.addData(reportText);
        qr.make();
        
        qrcodeContainer.innerHTML = qr.createImgTag(5); 
        
        downloadReportButton.disabled = false;
        confirmSendCheckbox.disabled = false;
        isReportGenerated = true;

        window.currentReportText = reportText;
    }

    function downloadReport() {
        if (!isReportGenerated) return;

        const blob = new Blob([window.currentReportText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `–û—Ç—á–µ—Ç_–°–º–µ–Ω—ã_${accountData.login}_${Date.now()}.txt`;
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        downloadReportButton.disabled = true;
        updateUI();
    }

    function completeShift() {
        if (confirmSendCheckbox.checked) {
            alert(`‚úÖ –°–º–µ–Ω–∞ –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞ ${accountData.login} —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!`);
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞—Ç–Ω–æ –≤ Google –¢–∞–±–ª–∏—Ü—É
            location.reload(); 
        } else {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –≤—ã —Å–∫–∞—á–∞–ª–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ñ–∞–π–ª –º–µ–Ω–µ–¥–∂–µ—Ä—É!");
        }
    }
    
    confirmSendCheckbox.addEventListener('change', updateUI);
    
    document.getElementById('loginInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') handleLogin();
    });
    document.getElementById('passwordInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') handleLogin();
    });
    
</script>
</body>
</html>